# Gemini CLI環境構築までのトラブルシューティング・ステップガイド
> Generated By #Perplexity

このドキュメントは、Node.jsの古いバージョンがインストールされた環境から、Gemini CLIが要求する実行環境を整えるまでの一連のプロセスと、その過程で発生したエラーおよび解決策をまとめたものです。

---

### Step 1: 初期状態の確認と課題の特定

最初に、現在のNode.jsのバージョンを確認したところ、目標とするバージョンよりも古いことが判明しました。

- **実行したコマンド:**
`node -v`

- **表示されたバージョン:**
`v16.13.0`
- **課題:**
Gemini CLIを利用するには、Node.jsのバージョンが`v18.0.0`以上である必要がある。

---

### Step 2: npmアップデートの試みと `EBADENGINE` エラー

パッケージマネージャー(npm)を利用してNode.jsを更新しようと試みましたが、最初の壁にぶつかりました。

- **発生したエラー:**
```bash
npm ERR! code EBADENGINE
npm ERR! engine Unsupported engine
npm ERR! notsup Required: {"node":"^20.17.0 || >=22.9.0"}
npm ERR! notsup Actual: {"npm":"8.1.0","node":"v16.13.0"}
```
- **躓いたポイント:**
npm自体をアップデートしようとしたが、そのnpmの新バージョンが要求するNode.jsのバージョンを、現在の環境(`v16.13.0`)が満たしていなかった。
- **解決策/学んだこと:**
npmを更新する前に、**まずNode.js本体のバージョンを上げる必要がある**と理解しました。

---

### Step 3: nvm利用の試みと `command not found` エラー

Node.jsのバージョンを柔軟に管理するため、Node Version Manager (nvm) を利用することにしました。しかし、インストール直後に新たなエラーが発生しました。

- **実行しようとしたコマンド:**
`nvm install 18`
- **発生したエラー:**
`-bash: nvm: command not found`
- **躓いたポイント:**
nvmのインストールスクリプトは実行したものの、その設定が現在のターミナルセッションに読み込まれておらず、シェルが`nvm`コマンドを見つけられませんでした。
- **実行した処理:**
1. ターミナルを一度完全に閉じて、再度開く。
2. （または `source ~/.bashrc` コマンドで設定ファイルを再読み込みする）
- **結果:**
`nvm`コマンドが正常に認識されるようになりました。

---

### Step 4: Node.js v18インストールと、依存関係による再度のバージョン警告

nvmを使ってNode.jsを`v18`にアップデートし、いよいよGemini CLIをインストールしようとしたところ、エラーではなく**警告**が表示されました。

- **実行したコマンド:**
`npm install -g @google/gemini-cli`

- **表示された警告:**
```bash
npm warn EBADENGINE Unsupported engine {
package: '@google/genai@1.6.0',
required: { node: '>=20.0.0' },
current: { node: 'v18.20.8', npm: '10.8.2' }
}
```
- **躓いたポイント:**
Gemini CLI本体の要件は満たしていましたが、その内部で利用されている依存パッケージ (`@google/genai`など) が、より新しいNode.jsのバージョン(`v20.0.0`以上)を要求していました。
- **解決策/学んだこと:**
パッケージの依存関係まで考慮し、**推奨されている最新のLTS版にアップデートする**のが最も安全であると判断しました。

---

### Step 5: Node.js v20へのアップグレードと環境構築完了

最終的に、nvmを使ってNode.jsを最新のLTS版（v20系）にアップデートすることで、すべての問題を解決しました。

- **実行したコマンド:**
最新のLTS版 (v20系) をインストール
`nvm install --lts`

インストールしたLTS版を使用する
`nvm use --lts`

今後、新しいターミナルを開いた際に自動でLTS版が使われるように設定
`nvm alias default lts`

- **最終確認:**
`node -v` を実行し、バージョンが `v20.x.x` になっていることを確認。
- **最終的なインストールコマンド:**
`npm install -g @google/gemini-cli`

- **結果:**
警告メッセージが表示されることなく、クリーンな状態でGemini CLIのインストールが完了。無事に利用環境を整備できました。
